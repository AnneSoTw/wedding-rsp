const translations = {
    en: {
        headerTitle: "Our Wedding",
        headerDescription: "Join us to celebrate our special day! Please RSVP by [Your RSVP Date Here].",
        page1Title: "Guest Information",
        guestSideLabel: "Are you a guest of the:",
        guestSideGroom: "Groom's Side",
        guestSideBride: "Bride's Side",
        chineseNameLabel: "Chinese Name (姓名):",
        chineseNameHelper: "Required if you are a guest of the Groom.",
        englishNameLabel: "English Name:",
        englishNameHelper: "Required if you are a guest of the Bride.",
        emailLabel: "Email (電子郵件):",
        attendanceLabel: "Will you be able to attend?",
        attendanceYes: "Yes, I will attend",
        attendanceNo: "Sorry, I cannot attend",
        nextButton: "Next",
        prevButton: "Previous",
        // Page 2
        page2Title: "Accompanying Guests",
        page2Description: "Please add details for each person attending with you (including yourself if you are attending).",
        addGuestButton: "Add Guest",
        guestEntryTitle: "Guest",
        guestNameLabel: "Name (姓名):",
        isChildLabel: "Is this guest a child? (是否為兒童)",
        childSeatLabel: "Child Seat Needed? (需要兒童座椅?)",
        childMealLabel: "Child Meal Needed? (需要兒童餐?)",
        mealPreferenceLabel: "Meal Preference (飲食偏好):",
        mealStandard: "Standard (標準)",
        mealVegetarian: "Vegetarian (素食)",
        mealVegan: "Vegan (全素)",
        mealOther: "Other (其他 - please specify)",
        allergiesLabel: "Any dietary restrictions or allergies? (飲食限制或過敏):",
        allergiesPlaceholder: "e.g., nuts, gluten-free...",
        removeGuestButton: "Remove",
        // Page 3
        page3Title: "Contact Preferences",
        page3Description: "How do you prefer we contact you for updates? (Select all that apply and provide details)",
        contactPhone: "Phone (電話)",
        contactPhonePlaceholder: "Enter phone number",
        contactEmail: "Email (電子郵件)",
        contactEmailPlaceholder: "Enter email address",
        contactLine: "LINE",
        contactLinePlaceholder: "Enter LINE ID",
        contactWhatsapp: "WhatsApp",
        contactWhatsappPlaceholder: "Enter WhatsApp number",
        contactIg: "Instagram",
        contactIgPlaceholder: "Enter Instagram handle",
        contactFacebook: "Facebook",
        contactFacebookPlaceholder: "Enter Facebook name/profile link",
        // Final Page
        finalPageTitle: "Final Step",
        messageLabel: "Any message for the couple?",
        messagePlaceholder: "Your wishes, song requests, etc.",
        lineInfo: "You can also add us on LINE!",
        lineLinkText: "Click here to add us on LINE",
        submitRsvpButton: "Submit RSVP",
        // Thank You
        thankYouTitle: "Thank You!",
        thankYouBodyAttending: "Your response has been recorded. We eagerly look forward to celebrating with you! A confirmation email has been sent.",
        thankYouBodyNotAttending: "Your response has been recorded. We're sad you can't make it, but we appreciate you letting us know. A confirmation email has been sent.",
        saveTheDate: "We're Excited!",
        // Status Messages
        emailSending: "Sending your RSVP...",
        emailSuccess: "RSVP sent successfully! You should receive a confirmation email shortly.",
        emailError: "Failed to send RSVP. Please try again or contact us directly.",
        // Validation
        validationRequired: "This field is required.",
        validationEmail: "Please enter a valid email address.",
        validationGuestSide: "Please select if you are a guest of the Groom or Bride.",
        validationAttendance: "Please let us know if you can attend.",
        validationChineseNameRequired: "Chinese name is required for Groom's side.",
        validationEnglishNameRequired: "English name is required for Bride's side.",
        validationContactMethod: "Please provide details for the selected contact methods.",
        backToStart: "Back to Start"

    },
    zh: {
        headerTitle: "我們的婚禮",
        headerDescription: "誠摯邀請您參與我們的婚禮！請於 [您的回覆截止日期] 前回覆。",
        page1Title: "賓客資訊",
        guestSideLabel: "您是男方或女方親友：",
        guestSideGroom: "新郎親友",
        guestSideBride: "新娘親友",
        chineseNameLabel: "中文姓名:",
        chineseNameHelper: "若您是新郎親友，此欄位為必填。",
        englishNameLabel: "英文姓名:",
        englishNameHelper: "若您是新娘親友，此欄位為必填。",
        emailLabel: "電子郵件:",
        attendanceLabel: "您是否能出席？",
        attendanceYes: "是的，我會參加",
        attendanceNo: "抱歉，無法出席",
        nextButton: "下一步",
        prevButton: "上一頁",
        // Page 2
        page2Title: "同行賓客資料",
        page2Description: "請填寫所有出席賓客的資料（若您會出席，也請包含您自己）。",
        addGuestButton: "新增同行賓客",
        guestEntryTitle: "賓客",
        guestNameLabel: "姓名:",
        isChildLabel: "是否為兒童?",
        childSeatLabel: "需要兒童座椅?",
        childMealLabel: "需要兒童餐?",
        mealPreferenceLabel: "飲食偏好:",
        mealStandard: "標準",
        mealVegetarian: "素食",
        mealVegan: "全素",
        mealOther: "其他 (請註明)",
        allergiesLabel: "飲食限制或過敏:",
        allergiesPlaceholder: "例如：堅果、無麩質...",
        removeGuestButton: "移除此位",
        // Page 3
        page3Title: "聯絡偏好",
        page3Description: "我們應如何與您聯絡後續事宜？（可複選並填寫資料）",
        contactPhone: "電話",
        contactPhonePlaceholder: "請輸入電話號碼",
        contactEmail: "電子郵件",
        contactEmailPlaceholder: "請輸入電子郵件地址",
        contactLine: "LINE",
        contactLinePlaceholder: "請輸入LINE ID",
        contactWhatsapp: "WhatsApp",
        contactWhatsappPlaceholder: "請輸入WhatsApp號碼",
        contactIg: "Instagram",
        contactIgPlaceholder: "請輸入Instagram帳號",
        contactFacebook: "Facebook",
        contactFacebookPlaceholder: "請輸入Facebook名稱/個人檔案連結",
        // Final Page
        finalPageTitle: "最後一步",
        messageLabel: "給新人的祝福或留言：",
        messagePlaceholder: "您的祝福、想點播的歌曲等",
        lineInfo: "您也可以加入我們的LINE！",
        lineLinkText: "點此加入我們的LINE",
        submitRsvpButton: "送出回覆",
        // Thank You
        thankYouTitle: "感謝您！",
        thankYouBodyAttending: "您的回覆已成功送出。我們熱切期待與您一同慶祝！確認郵件已寄出。",
        thankYouBodyNotAttending: "您的回覆已成功送出。很遺憾您無法參加，但感謝您的告知。確認郵件已寄出。",
        saveTheDate: "期待相見！",
        // Status Messages
        emailSending: "正在發送您的回覆...",
        emailSuccess: "回覆已成功發送！您很快就會收到一封確認郵件。",
        emailError: "回覆發送失敗。請稍後再試或直接與我們聯繫。",
         // Validation
        validationRequired: "此欄位為必填。",
        validationEmail: "請輸入有效的電子郵件地址。",
        validationGuestSide: "請選擇您是男方或女方親友。",
        validationAttendance: "請告知您是否能出席。",
        validationChineseNameRequired: "新郎親友需填寫中文姓名。",
        validationEnglishNameRequired: "新娘親友需填寫英文姓名。",
        validationContactMethod: "請為已選的聯絡方式提供詳細資料。",
        backToStart: "返回首頁"
    }
};

let currentLanguage = 'en';
let currentPage = 'page1';
const rsvpData = {
    guests: []
};

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    setLanguage(currentLanguage);
    showPage(currentPage);
    document.getElementById('langEn').addEventListener('click', () => setLanguage('en'));
    document.getElementById('langZh').addEventListener('click', () => setLanguage('zh'));

    // Initialize choice buttons
    document.querySelectorAll('.choice-button[name="guestSide"]').forEach(button => {
        button.addEventListener('click', (e) => {
            document.querySelectorAll('.choice-button[name="guestSide"]').forEach(btn => btn.classList.remove('selected'));
            e.currentTarget.classList.add('selected');
            document.getElementById('guestSide').value = e.currentTarget.dataset.value;
            updateNameRequirement(e.currentTarget.dataset.value);
        });
    });
     document.querySelectorAll('.choice-button[name="attendance"]').forEach(button => {
        button.addEventListener('click', (e) => {
            document.querySelectorAll('.choice-button[name="attendance"]').forEach(btn => btn.classList.remove('selected'));
            e.currentTarget.classList.add('selected');
            document.getElementById('attendance').value = e.currentTarget.dataset.value;
        });
    });

    // EmailJS Init - REPLACE WITH YOUR ACTUAL ID
    emailjs.init("YOUR_USER_PUBLIC_KEY"); // Replace with your EmailJS User ID (Public Key)

    // Pre-add one guest entry if attending (for the main respondent)
    // addGuestEntry(true); // Add main respondent by default
});


// --- LANGUAGE TOGGLE ---
function setLanguage(lang) {
    currentLanguage = lang;
    document.documentElement.lang = lang;
    document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.dataset.translate;
        if (translations[lang][key]) {
            el.innerHTML = translations[lang][key];
        }
    });
    document.querySelectorAll('[placeholder-translate]').forEach(el => {
        const key = el.placeholderTranslate;
        if (translations[lang][key]) {
            el.placeholder = translations[lang][key];
        }
    });

    // Update active lang button
    document.getElementById('langEn').classList.toggle('active', lang === 'en');
    document.getElementById('langZh').classList.toggle('active', lang === 'zh');

    // Update name requirement helpers based on current language
    const guestSide = document.getElementById('guestSide').value;
    if (guestSide) {
        updateNameRequirement(guestSide);
    } else { // Default prompt if no side selected yet
        document.getElementById('chineseNameHelper').textContent = translations[currentLanguage].chineseNameHelper;
        document.getElementById('englishNameHelper').textContent = translations[currentLanguage].englishNameHelper;
    }

     // Update button text for dynamically added elements like remove guest
    document.querySelectorAll('.remove-guest-button').forEach(button => {
        button.innerHTML = `<span class="lang-zh">${translations.zh.removeGuestButton}</span><span class="lang-en">${translations.en.removeGuestButton}</span>`;
    });
    document.querySelectorAll('.guest-entry h3').forEach(header => {
         header.innerHTML = `<span class="lang-zh">${translations.zh.guestEntryTitle}</span><span class="lang-en">${translations.en.guestEntryTitle}</span>`;
    });
}

// --- PAGE NAVIGATION ---
function showPage(pageId) {
    document.querySelectorAll('.form-page').forEach(page => page.classList.add('hidden'));
    const targetPage = document.getElementById(pageId);
    if (targetPage) {
        targetPage.classList.remove('hidden');
        currentPage = pageId;
        window.scrollTo(0, 0); // Scroll to top of page
    } else {
        console.error("Page not found:", pageId);
    }
}

// --- PAGE 1 LOGIC ---
function updateNameRequirement(side) {
    const chineseNameInput = document.getElementById('chineseName');
    const englishNameInput = document.getElementById('englishName');
    const chineseNameHelper = document.getElementById('chineseNameHelper');
    const englishNameHelper = document.getElementById('englishNameHelper');

    chineseNameInput.required = (side === 'groom');
    englishNameInput.required = (side === 'bride');

    chineseNameHelper.textContent = translations[currentLanguage].chineseNameHelper;
    englishNameHelper.textContent = translations[currentLanguage].englishNameHelper;

    if (side === 'groom') {
        chineseNameHelper.style.fontWeight = 'bold';
        englishNameHelper.style.fontWeight = 'normal';
    } else if (side === 'bride') {
        englishNameHelper.style.fontWeight = 'bold';
        chineseNameHelper.style.fontWeight = 'normal';
    } else {
        englishNameHelper.style.fontWeight = 'normal';
        chineseNameHelper.style.fontWeight = 'normal';
    }
}

function handleAttendance(response) {
    document.getElementById('attendance').value = response; // Already handled by choice-button setup
    const nextPage1Button = document.getElementById('nextPage1');
    if (response === 'no') {
        // Change button text/function if going straight to final page
        nextPage1Button.onclick = () => {
            if (validatePage1()) {
                rsvpData.attending = 'no';
                showFinalPageForNoAttending();
            }
        };
    } else {
        nextPage1Button.onclick = () => validateAndGoToPage2();
    }
}

function validatePage1() {
    let isValid = true;
    const guestSide = document.getElementById('guestSide').value;
    const chineseName = document.getElementById('chineseName').value.trim();
    const englishName = document.getElementById('englishName').value.trim();
    const email = document.getElementById('email').value.trim();
    const attendance = document.getElementById('attendance').value;

    if (!guestSide) {
        alert(translations[currentLanguage].validationGuestSide);
        isValid = false;
    } else if (guestSide === 'groom' && !chineseName) {
        alert(translations[currentLanguage].validationChineseNameRequired);
        isValid = false;
        document.getElementById('chineseName').focus();
    } else if (guestSide === 'bride' && !englishName) {
        alert(translations[currentLanguage].validationEnglishNameRequired);
        isValid = false;
        document.getElementById('englishName').focus();
    }
    if (!email || !/^\S+@\S+\.\S+$/.test(email)) {
        alert(translations[currentLanguage].validationEmail);
        isValid = false;
        if(isValid) document.getElementById('email').focus(); // only focus if previous checks passed
    }
    if (!attendance) {
        alert(translations[currentLanguage].validationAttendance);
        isValid = false;
    }
    return isValid;
}

function validateAndGoToPage2() {
    if (!validatePage1()) return;
    rsvpData.guestSide = document.getElementById('guestSide').value;
    rsvpData.chineseName = document.getElementById('chineseName').value.trim();
    rsvpData.englishName = document.getElementById('englishName').value.trim();
    rsvpData.email = document.getElementById('email').value.trim();
    rsvpData.attending = document.getElementById('attendance').value;

    if (rsvpData.attending === 'yes') {
        // Ensure at least one guest entry for the respondent themselves
        if (document.getElementById('guestListContainer').childElementCount === 0) {
             addGuestEntry(true); // Add main respondent
        }
        showPage('page2');
    } else {
        showFinalPageForNoAttending();
    }
}


function showFinalPageForNoAttending() {
    document.getElementById('finalPageContent').classList.remove('hidden');
    document.getElementById('thankYouMessage').classList.add('hidden');
    document.getElementById('backToStartButton').classList.add('hidden');
    showPage('finalPage');
}


// --- PAGE 2 LOGIC (GUEST ENTRIES) ---
let guestCounter = 0;
function addGuestEntry(isMainRespondent = false) {
    guestCounter++;
    const template = document.getElementById('guestEntryTemplate').content.cloneNode(true);
    const guestEntryDiv = template.querySelector('.guest-entry');
    guestEntryDiv.dataset.guestId = guestCounter;

    // Translate static text within the template before appending
    template.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.dataset.translate;
        if (translations[currentLanguage][key]) {
            el.innerHTML = translations[currentLanguage][key];
        }
    });
    template.querySelectorAll('[placeholder-translate]').forEach(el => {
        const key = el.placeholderTranslate;
        if (translations[currentLanguage][key]) {
            el.placeholder = translations[currentLanguage][key];
        }
    });

    // Set default name if it's the main respondent
    if (isMainRespondent) {
        const guestNameInput = guestEntryDiv.querySelector('input[name="guestName"]');
        const mainChineseName = document.getElementById('chineseName').value.trim();
        const mainEnglishName = document.getElementById('englishName').value.trim();
        if (mainChineseName && mainEnglishName) {
             guestNameInput.value = currentLanguage === 'zh' ? mainChineseName + " (" + mainEnglishName + ")" : mainEnglishName + " (" + mainChineseName + ")";
        } else {
            guestNameInput.value = mainChineseName || mainEnglishName;
        }
    }


    document.getElementById('guestListContainer').appendChild(template);
    setLanguage(currentLanguage); // Re-apply language to new elements
}

function removeGuestEntry(button) {
    button.closest('.guest-entry').remove();
}

function toggleChildOptions(checkbox) {
    const childOptionsDiv = checkbox.closest('.guest-entry').querySelector('.child-options');
    childOptionsDiv.classList.toggle('hidden', !checkbox.checked);
}

function validatePage2() {
    let isValid = true;
    const guestEntries = document.querySelectorAll('#guestListContainer .guest-entry');
    if (guestEntries.length === 0 && rsvpData.attending === 'yes') {
        alert(translations[currentLanguage].page2Description); // Remind to add themselves at least
        isValid = false;
    }
    guestEntries.forEach(entry => {
        const nameInput = entry.querySelector('input[name="guestName"]');
        if (!nameInput.value.trim()) {
            alert(translations[currentLanguage].validationRequired + " (" + translations[currentLanguage].guestNameLabel + ")");
            nameInput.focus();
            isValid = false;
        }
    });
    return isValid;
}

function validateAndGoToPage3() {
    if (!validatePage2()) return;
    // Collect guest data
    rsvpData.guests = [];
    document.querySelectorAll('#guestListContainer .guest-entry').forEach(entry => {
        const guest = {
            name: entry.querySelector('input[name="guestName"]').value.trim(),
            isChild: entry.querySelector('input[name="isChild"]').checked,
            childSeat: entry.querySelector('input[name="childSeat"]').checked,
            childMeal: entry.querySelector('input[name="childMeal"]').checked,
            mealPreference: entry.querySelector('select[name="mealPreference"]').value,
            allergies: entry.querySelector('textarea[name="allergies"]').value.trim()
        };
        rsvpData.guests.push(guest);
    });
    showPage('page3');
}

// --- PAGE 3 LOGIC (CONTACT PREFERENCES) ---
function toggleContactInput(method) {
    const inputField = document.getElementById(`contact${method.charAt(0).toUpperCase() + method.slice(1)}Input`);
    const checkbox = document.querySelector(`input[name="contactMethod"][value="${method}"]`);
    if (inputField) {
        inputField.classList.toggle('hidden', !checkbox.checked);
        if (checkbox.checked) {
            inputField.required = true;
            inputField.focus();
        } else {
            inputField.required = false;
            inputField.value = ''; // Clear if unchecked
        }
    }
}
function validatePage3() {
    let isValid = true;
    const contactMethods = document.querySelectorAll('input[name="contactMethod"]:checked');
    if (contactMethods.length > 0) {
        contactMethods.forEach(checkbox => {
            const inputField = document.getElementById(`contact${checkbox.value.charAt(0).toUpperCase() + checkbox.value.slice(1)}Input`);
            if (!inputField.value.trim()) {
                alert(translations[currentLanguage].validationContactMethod + ` (${translations[currentLanguage]['contact' + checkbox.value.charAt(0).toUpperCase() + checkbox.value.slice(1)]})`);
                inputField.focus();
                isValid = false;
            }
        });
    }
    // No validation needed if no contact method is chosen, it's optional.
    return isValid;
}

function validateAndGoToFinalPage() {
    if (!validatePage3()) return;
    // Collect contact preferences
    rsvpData.contactPreferences = [];
    document.querySelectorAll('input[name="contactMethod"]:checked').forEach(checkbox => {
        const method = checkbox.value;
        const inputField = document.getElementById(`contact${method.charAt(0).toUpperCase() + method.slice(1)}Input`);
        rsvpData.contactPreferences.push({
            method: method,
            detail: inputField.value.trim()
        });
    });
    document.getElementById('finalPageContent').classList.remove('hidden');
    document.getElementById('thankYouMessage').classList.add('hidden');
    document.getElementById('backToStartButton').classList.add('hidden');
    showPage('finalPage');
}

// --- FINAL PAGE & SUBMISSION ---
function submitForm() {
    rsvpData.message = document.getElementById('message').value.trim();
    const emailStatusDiv = document.getElementById('emailStatus');

    // Update status message
    emailStatusDiv.textContent = translations[currentLanguage].emailSending;
    emailStatusDiv.className = 'email-status-message email-sending'; // Reset classes and add sending

    // --- Construct email parameters ---
    let guestListSummary = "";
    if (rsvpData.attending === 'yes' && rsvpData.guests.length > 0) {
        guestListSummary = "Attending Guests:\n";
        rsvpData.guests.forEach(guest => {
            guestListSummary += `- ${guest.name}`;
            if (guest.isChild) {
                guestListSummary += " (Child";
                if (guest.childSeat) guestListSummary += ", Needs Seat";
                if (guest.childMeal) guestListSummary += ", Needs Child Meal";
                guestListSummary += ")";
            }
            guestListSummary += `\n  Meal: ${guest.mealPreference}`;
            if (guest.allergies) guestListSummary += `\n  Allergies: ${guest.allergies}`;
            guestListSummary += "\n\n";
        });
    } else if (rsvpData.attending === 'no') {
        guestListSummary = "Not attending.";
    }

    let contactPrefSummary = "Contact Preferences:\n";
    if (rsvpData.contactPreferences && rsvpData.contactPreferences.length > 0) {
        rsvpData.contactPreferences.forEach(pref => {
            contactPrefSummary += `- ${pref.method}: ${pref.detail}\n`;
        });
    } else {
        contactPrefSummary = "No specific contact preferences selected beyond primary email.\n";
    }

    const templateParamsCouple = {
        guest_side: rsvpData.guestSide === 'groom' ? translations.en.guestSideGroom : translations.en.guestSideBride, // For your email, maybe keep EN
        chinese_name: rsvpData.chineseName || "N/A",
        english_name: rsvpData.englishName || "N/A",
        user_email: rsvpData.email,
        attending: rsvpData.attending === 'yes' ? "Yes" : "No",
        guest_details: guestListSummary,
        contact_preferences: contactPrefSummary,
        message_to_couple: rsvpData.message || "No message.",
        submission_time: new Date().toLocaleString()
    };

    const templateParamsGuest = {
        to_name: rsvpData.englishName || rsvpData.chineseName, // Use whichever is available for salutation
        user_email: rsvpData.email,
        attending_status: rsvpData.attending === 'yes' ? "We're delighted you'll be joining us!" : "We're sorry you can't make it, but thank you for letting us know.",
        wedding_date: "[Your Wedding Date Here]", // Replace with actual date
        wedding_location: "[Your Wedding Location Here]" // Replace
    };

    // --- Send Email to Couple ---
    // REPLACE with your Service ID and Template ID for the email TO YOU
    emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID_FOR_COUPLE', templateParamsCouple)
        .then((response) => {
            console.log('SUCCESS sending email to couple!', response.status, response.text);
            // --- Send Confirmation Email to Guest ---
            // REPLACE with your Service ID and Template ID for the email TO GUEST
            return emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID_FOR_GUEST', templateParamsGuest);
        })
        .then((response) => {
            console.log('SUCCESS sending confirmation to guest!', response.status, response.text);
            emailStatusDiv.textContent = translations[currentLanguage].emailSuccess;
            emailStatusDiv.className = 'email-status-message email-success';
            document.getElementById('finalPageContent').classList.add('hidden');
            document.getElementById('thankYouMessage').classList.remove('hidden');
            document.getElementById('backToStartButton').classList.remove('hidden');

            // Update thank you message based on attendance
            const thankYouBody = document.querySelector('#thankYouMessage .award-text');
            if(rsvpData.attending === 'yes') {
                thankYouBody.dataset.translate = "thankYouBodyAttending";
                thankYouBody.innerHTML = translations[currentLanguage].thankYouBodyAttending;
            } else {
                thankYouBody.dataset.translate = "thankYouBodyNotAttending";
                thankYouBody.innerHTML = translations[currentLanguage].thankYouBodyNotAttending;
            }

        })
        .catch((error) => {
            console.error('FAILED to send email...', error);
            emailStatusDiv.textContent = translations[currentLanguage].emailError + " (" + error.text + ")";
            emailStatusDiv.className = 'email-status-message email-error';
        });
}

function resetFormAndGoToStart() {
    // Reset form elements
    document.getElementById('rsvpFormContainer').reset(); // Assuming your main form container has this ID, or reset individual forms.
    // More robust reset:
    document.querySelectorAll('input[type="text"], input[type="email"], textarea').forEach(input => input.value = '');
    document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => input.checked = false);
    document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
    document.querySelectorAll('.choice-button.selected').forEach(btn => btn.classList.remove('selected'));
    document.getElementById('guestListContainer').innerHTML = ''; // Clear dynamic guests
    document.querySelectorAll('.contact-input').forEach(input => input.classList.add('hidden'));


    // Reset RSVP data object
    Object.keys(rsvpData).forEach(key => {
        if (Array.isArray(rsvpData[key])) {
            rsvpData[key] = [];
        } else {
            delete rsvpData[key];
        }
    });
    guestCounter = 0;


    // Hide thank you, show first page
    document.getElementById('finalPageContent').classList.remove('hidden'); // Ensure main content area is visible for next time
    document.getElementById('thankYouMessage').classList.add('hidden');
    document.getElementById('backToStartButton').classList.add('hidden');
    document.getElementById('emailStatus').textContent = ''; // Clear email status

    // Reset button states or onclick handlers if they were changed
     document.getElementById('nextPage1').onclick = () => validateAndGoToPage2();


    setLanguage(currentLanguage); // Re-apply language to ensure all defaults are set
    showPage('page1');
}

// Wrap the main container in a form if you want to use form.reset()
// For this example, will manually reset fields if needed.
// For now, let's assume the main container has id 'rsvp-container' for easier selection for reset,
// but a better way is to wrap page1, page2, page3 in a <form> tag.
// The HTML was updated to reflect this by adding a main form container.
// The script assumes the rsvp-container is the overall wrapper, not a form element itself.
// If you add <form id="mainRsvpForm"> around all pages, you can use document.getElementById('mainRsvpForm').reset();
// For now, the manual reset approach is in resetFormAndGoToStart().
